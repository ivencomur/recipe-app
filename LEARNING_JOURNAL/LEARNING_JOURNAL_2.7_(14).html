<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learning Journal – Exercise 2.7</title>
    <style>
      :root {
        --primary-color: #20504b;
        --primary-hover-color: #1a403c;
        --secondary-color: #f4f4f4;
        --text-color: #333;
        --grid-item-bg-color: #2c3e50;
        --alt-grid-item-text-color: #0056b3;
        --customized-orange-light-bg: #b46100;
        --customized-orange-dark-bg: #ffa061;
        --error-color: #d9534f;
      }
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font-family: "Lato", sans-serif; line-height: 1.6; color: var(--text-color); background-color: #d9e1e5; padding: 20px; }
      .container { max-width: 8.5in; margin: 0 auto; background: white; padding: 0.75in; box-shadow: 0 0 10px rgba(0,0,0,.1); }
      .page-header { background-color: var(--primary-color); color: #fff; padding: 20px; text-align: center; margin: -0.75in -0.75in 30px -0.75in; }
      .page-header h1 { color: #fff; border-bottom: none; margin-bottom: 5px; }
      h1 { color: var(--alt-grid-item-text-color); font-size: 28px; margin-bottom: 10px; border-bottom: 3px solid var(--primary-color); padding-bottom: 10px; }
      .header-info { color: #fff; font-size: 14px; line-height: 1.8; }
      .header-info strong { color: var(--customized-orange-dark-bg); }
      h2 { color: var(--alt-grid-item-text-color); font-size: 20px; margin-top: 30px; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 2px solid var(--primary-color); }
      h3 { color: var(--grid-item-bg-color); font-size: 16px; margin-top: 20px; margin-bottom: 10px; }
      p { margin-bottom: 12px; text-align: justify; }
      ul, ol { margin-left: 25px; margin-bottom: 15px; }
      li { margin-bottom: 8px; }
      .toc { background-color: var(--secondary-color); border: 2px solid var(--primary-color); border-radius: 5px; padding: 20px 30px; margin: 25px 0 40px 0; }
      .toc h2 { margin-top: 0; border-bottom: none; color: var(--primary-color); }
      .toc ol { margin-left: 20px; counter-reset: item; list-style-type: none; }
      .toc li { counter-increment: item; margin-bottom: 8px; }
      .toc li:before { content: counter(item) ") "; font-weight: bold; color: var(--primary-color); }
      .toc a { color: var(--customized-orange-light-bg); text-decoration: none; font-weight: bold; }
      .toc a:hover { color: var(--primary-hover-color); text-decoration: underline; }
      .code-block { background-color: var(--secondary-color); border-left: 4px solid var(--primary-color); padding: 15px; margin: 15px 0; font-family: "Courier New", monospace; font-size: 13px; overflow-x: auto; border-radius: 3px; }
      .simple-box { background-color: var(--secondary-color); border: 2px solid var(--primary-color); border-radius: 5px; padding: 15px; margin: 20px 0; text-align: center; font-weight: bold; color: var(--primary-color); }
      .challenge-item { margin-bottom: 20px; }
      .challenge-title { font-weight: bold; color: var(--customized-orange-light-bg); margin-bottom: 5px; }
      .solution { color: var(--primary-color); font-weight: bold; }
      .page-footer { background-color: var(--primary-color); color: #fff; padding: 1.5rem 2rem; text-align: center; font-size: 0.875rem; margin: 30px -0.75in -0.75in -0.75in; }
      .page-footer a { color: var(--customized-orange-dark-bg); font-weight: bold; text-decoration: none; }
      .page-footer a:hover { color: #fff; text-decoration: underline; }
      .page-footer .social-links { margin-bottom: 15px; }
      .page-footer .social-links a { margin: 0 10px; }
      hr { border: none; border-top: 2px solid var(--primary-color); margin: 30px 0; }
      .floating-nav { position: fixed; bottom: 25px; right: 25px; display: flex; flex-direction: column; gap: 10px; z-index: 1000; }
      .floating-nav a { background-color: var(--primary-color); color: white; padding: 12px; border-radius: 50%; text-decoration: none; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,.2); transition: all .3s ease; font-size: 20px; text-align: center; width: 50px; height: 50px; line-height: 26px; }
      .floating-nav a:hover { background-color: var(--customized-orange-dark-bg); color: var(--primary-color); transform: translateY(-2px); }
      .section { margin-bottom: 35px; }
      table { width: 100%; border-collapse: collapse; margin: 15px 0; }
      th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
      th { background-color: var(--secondary-color); }
      code { background-color: #f0f0f0; padding: 2px 5px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 14px; }
      .screenshot-list li { list-style-type: disc; margin-left: 0; padding-left: 0; } /* Keep default list style */
      .screenshot-list ul { margin-left: 40px; }
      @media print {
        body { background: white; padding: 0; }
        .container { max-width: 100%; width: 8.5in; padding: 0.75in; box-shadow: none; margin: 0; }
        @page { size: letter; margin: 0.75in; }
        h1, h2, h3 { page-break-after: avoid; page-break-inside: avoid; }
        .section, .code-block, .challenge-item, table { page-break-inside: avoid; }
        .toc { page-break-after: always; }
        a { color: #2980b9; text-decoration: none; }
        .floating-nav { display: none; }
        .page-header, .page-footer { background-color: #eee !important; color: #333 !important; }
        .page-header h1, .header-info strong, .page-footer a { color: #333 !important; }
       }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1>Learning Journal – Exercise 2.7</h1>
            <div class="header-info">
              <strong>Name:</strong> Ivan Cortes<br />
              <strong>Course:</strong> CareerFoundry – Python for Web Developers<br />
              <strong>Exercise:</strong> 2.7 – Django Forms & Data Visualization<br />
              <strong>Date:</strong> October 19, 2025
            </div>
        </div>

         <div class="toc">
            <h2>Table of Contents</h2>
            <ol>
              <li><a href="#about">What This Exercise Is About</a></li>
              <li><a href="#planning">Planning Phase: Search & Visualization</a></li>
              <li><a href="#implementation">Implementation Steps</a></li>
              <li><a href="#challenges">Challenges I Hit & How I Fixed Them</a></li>
              <li><a href="#skills">New Skills Acquired</a></li>
              <li><a href="#remember">What I'll Remember Most</a></li>
              <li><a href="#screenshots">Screenshots & Files</a></li>
              <li><a href="#next">What's Next</a></li>
              <li><a href="#ai">AI Assistance Declaration</a></li>
            </ol>
        </div>

        <div id="about" class="section">
            <h2>1) What This Exercise Is About</h2>
            <p>
                Exercise 2.7 adds significant interactivity and insight to the Recipe App. We shift from just displaying pre-existing data to allowing users to filter that data using Django Forms. This involves creating a dedicated search page where users can specify criteria like recipe name, ingredients, maximum cooking time, and the newly added 'difficulty' field.
            </p>
            <p>
                Furthermore, this exercise introduces data visualization. Using the results from the user's search, we leverage Pandas and Matplotlib to generate dynamic charts (bar, pie, line) directly within the web page. This demonstrates how to process user input, query the database accordingly, and present analytical insights visually, all within the Django MVT framework.
            </p>
        </div>

        <div id="planning" class="section">
            <h2>2) Planning Phase: Search & Visualization</h2>
            <p>
                A clear plan was established before coding, outlining the search fields, filtering logic, chart types, and user experience details.
            </p>
            <h3>Search Criteria Planning</h3>
            <ul>
                <li>Fields: Name, Ingredients (comma-separated), Max Cooking Time, Difficulty.</li>
                <li>Logic: Name (`icontains`), Ingredients (any term `icontains` using `Q` objects), Max Time (`<=`), Difficulty (exact match + "All").</li>
                <li>Output: Table (Name, Time, Difficulty, Details Link).</li>
            </ul>
            <h3>Data Visualization Planning</h3>
            <ul>
                <li>Bar Chart: Count per difficulty.</li>
                <li>Pie Chart: % by cooking time ranges (≤30, 31–60, >60 min).</li>
                <li>Line Chart: Cumulative recipe growth over time (`created_at`).</li>
            </ul>
            <h3>UX Decisions</h3>
            <ul>
                <li>"Show All" & "Reset" buttons.</li>
                <li>Login required for search page.</li>
            </ul>
        </div>

        <div id="implementation" class="section">
            <h2>3) Implementation Steps</h2>
            <p>
                The features were built through these key steps:
                <em>(Marked as completed during the guided process)</em>
            </p>
            <ol>
                <li>✅ Updated `Recipe` model (`difficulty` field) & ran migrations.</li>
                <li>✅ Installed `pandas`, `matplotlib` & updated `requirements.txt`.</li>
                <li>✅ Created `recipes/forms.py` (`RecipeSearchForm`).</li>
                <li>✅ Implemented `generate_recipe_chart` helper in `recipes/views.py`.</li>
                <li>✅ Implemented `recipe_search` view logic in `recipes/views.py`.</li>
                <li>✅ Created `recipes/templates/recipes/search.html`.</li>
                <li>✅ Added URL pattern for `recipe_search` in `recipes/urls.py`.</li>
                <li>✅ Wrote unit tests (`test_forms.py`, `test_views.py`).</li>
            </ol>
        </div>

        <div id="execution" class="section">
             <h2>Execution Flow (User Journey)</h2>
             <p>A typical user interaction with the search and visualization feature follows these steps:</p>
             <ol>
                 <li>User navigates to the application homepage.</li>
                 <li>User clicks the "Login" button (if not already logged in) and enters credentials on the login page.</li>
                 <li>After successful login, the user is redirected to the Recipe List page or homepage.</li>
                 <li>User navigates to the "Recipe Search" page (e.g., via a link in a navbar, or directly accessing `/recipes/search/`).</li>
                 <li>The search page displays the empty `RecipeSearchForm`.</li>
                 <li>User enters search criteria (e.g., "chicken" in name, "Easy" difficulty, selects "Bar Chart").</li>
                 <li>User clicks the "Search" button.</li>
                 <li>The page reloads (POST request). The view processes the form, filters recipes, generates the requested chart.</li>
                 <li>The page displays the search form (potentially pre-filled), the table of matching recipes, and the generated chart below the results.</li>
                 <li>User clicks "Reset" button. The page reloads (GET request), showing the empty form again.</li>
                 <li>User clicks "Show All Recipes" button.</li>
                 <li>The page reloads (POST request with `show_all` flag). The view skips filtering and displays all recipes.</li>
                 <li>User clicks on a recipe name in the results table to navigate to its detail page.</li>
             </ol>
        </div>

        <div id="challenges" class="section">
             <h2>4) Challenges I Hit & How I Fixed Them</h2>
             <p><em>(Documenting issues encountered during the build.)</em></p>
             <div class="challenge-item">
                 <div class="challenge-title">Chart Backend Configuration</div>
                 <p>Matplotlib initially caused errors related to GUI backends when run within the Django development server, or charts wouldn't appear.</p>
                 <span class="solution">The Fix:</span> Explicitly setting the backend to 'Agg' using `matplotlib.use('Agg')` *before* importing `pyplot` was crucial. Also, ensuring the image data was correctly encoded to base64 and embedded in the template using the `data:image/png;base64,...` URI format solved display issues. Added robust error handling within `generate_recipe_chart`.
             </div>
             <div class="challenge-item">
                 <div class="challenge-title">Ingredient OR Logic</div>
                 <p>A simple chain of `.filter()` calls for ingredients incorrectly implemented AND logic (all ingredients must match).</p>
                 <span class="solution">The Fix:</span> Switched to using `Q` objects from `django.db.models`. Looped through the user-provided ingredient terms, creating a `Q(ingredients__name__icontains=term)` for each, and combined them using the pipe operator (`|=`) before passing the final `Q` object to a single `.filter(combined_query).distinct()`.
             </div>
             <div class="challenge-item">
                <div class="challenge-title">Base64 Image Embedding</div>
                <p>Ensuring the chart image generated in memory was correctly encoded and displayed in the HTML template required careful handling.</p>
                <span class="solution">The Fix:</span> Used `BytesIO` to capture the `plt.savefig` output, then `base64.b64encode().decode('utf-8')` to get the string, and finally used the `data:image/png;base64,{{ chart }}` format in the `<img>` tag's `src` attribute.
            </div>
             </div>

        <div id="skills" class="section">
             <h2>5) New Skills Acquired</h2>
             <ul>
                 <li>Creating and validating Django Forms (`forms.Form`).</li>
                 <li>Handling GET/POST requests in views for form display and submission.</li>
                 <li>Using `form.cleaned_data` to access validated input.</li>
                 <li>Building dynamic QuerySets with multiple optional filters.</li>
                 <li>Applying advanced filters like `__icontains`, `__lte`.</li>
                 <li>Using `Q` objects for complex OR database queries.</li>
                 <li>Integrating Pandas for basic data aggregation from QuerySets.</li>
                 <li>Generating plots with Matplotlib using the 'Agg' backend.</li>
                 <li>Working with in-memory binary data using `BytesIO`.</li>
                 <li>Encoding/decoding data with `base64`.</li>
                 <li>Embedding images in HTML using Data URIs.</li>
                 <li>Writing unit tests for forms and views simulating POST requests.</li>
             </ul>
        </div>

        <div id="remember" class="section">
             <h2>6) What I'll Remember Most</h2>
             <p>
                 The seamless way Django Forms abstract away much of the complexity of handling HTML forms, validation, and data cleaning is a major takeaway. Defining the form in Python and letting Django handle the rendering and processing is very efficient.
             </p>
             <p>
                 Integrating Matplotlib and Pandas felt powerful. Generating visualizations directly from database queries and embedding them dynamically opens up many possibilities for data analysis within web apps. The `BytesIO` and `base64` pattern for handling the image data in memory without saving files is a key technique I'll reuse. Lastly, understanding how to construct OR queries with `Q` objects significantly expands my ability to filter data effectively.
             </p>
        </div>

        <div id="screenshots" class="section">
             <h2>7) Screenshots & Files</h2>
             <p>Key files created or updated during Exercise 2.7:</p>
             <ul class="screenshot-list">
                <li><code>recipes/models.py</code></li>
                <li><code>recipes/migrations/...</code></li>
                <li><code>requirements.txt</code></li>
                <li><code>recipes/forms.py</code></li>
                <li><code>recipes/views.py</code></li>
                <li><code>recipes/templates/recipes/search.html</code></li>
                <li><code>recipes/urls.py</code></li>
                <li><code>recipes/tests/test_forms.py</code></li>
                <li><code>recipes/tests/test_views.py</code></li>
                <li><code>README.md</code></li>
                <li><code>LEARNING_JOURNAL_2.7_(14).html</code> (This file)</li>
             </ul>
             <p>Required screenshots (saved in `PYTHON-ACHIEVEMENT-2` repo):</p>
              <ul class="screenshot-list">
                 <li><code>2.7_search_form_empty.png</code></li>
                 <li><code>2.7_search_results_table.png</code></li>
                 <li><code>2.7_chart_difficulty_bar.png</code></li>
                 <li><code>2.7_chart_time_pie.png</code></li>
                 <li><code>2.7_chart_growth_line.png</code></li>
                 <li><code>2.7_tests_passing.png</code></li>
             </ul>
        </div>

        <div id="next" class="section">
            <h2>8) What's Next</h2>
            <p>
                Having implemented search and visualization, the application feels much more complete. The final step for Achievement 2 is typically Exercise 2.8: Deployment. This involves configuring the application for a production environment (disabling DEBUG, setting allowed hosts, handling static files with WhiteNoise, potentially using environment variables for secrets) and deploying it to a Platform-as-a-Service (PaaS) like Render or Heroku using a production-grade web server like Gunicorn.
            </p>
        </div>

        <div id="ai" class="section">
             <h2>9) AI Assistance Declaration</h2>
             <p>
                 For Exercise 2.7, AI assistance was valuable for integrating external data science libraries (`pandas`, `matplotlib`) effectively within Django. This included clarifying the use of Matplotlib's 'Agg' backend for server environments, demonstrating the `BytesIO`/`base64` pattern for embedding in-memory charts, and providing examples for constructing OR queries using `Q` objects. AI also helped in structuring the form, view, and template code logically and troubleshooting specific library errors or syntax issues, especially when adapting course examples potentially based on older library versions. While the core Django concepts followed course patterns, AI served as a technical resource for these specific integration points and advanced querying techniques. All coding, testing, and debugging were performed hands-on.
             </p>
        </div>

        <hr />
        <div class="simple-box">Exercise 2.7 In Progress... Planning Complete. Ready for Implementation.</div>

        <div class="page-footer">
            <div class="social-links">
              <a href="https://ivan-cortes-portfolio-v1.onrender.com/" target="_blank">Portfolio</a> ·
              <a href="https://www.linkedin.com/in/ivan-cortes-murcia-2_hidden_part_>" target="_blank">LinkedIn</a> ·
              <a href="https://x.com/IVENCOMUR" target="_blank">Twitter</a> ·
              <a href="https://github.com/ivencomur" target="_blank">GitHub</a>
            </div>
            <p><a href="https://github.com/ivencomur/recipe-app" target="_blank">Recipe App Repository</a></p>
            <p>Python for Web Developers @ CareerFoundry 2025</p>
        </div>
    </div>

    <div class="floating-nav">
        <a href="../index.html" title="Go to Main Index">🏠</a>
        <a href="javascript:history.back()" title="Go Back">⬅️</a>
    </div>
    </body>
</html>