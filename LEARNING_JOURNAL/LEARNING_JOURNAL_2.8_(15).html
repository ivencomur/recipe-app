<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learning Journal – Exercise 2.8</title>
    <style>
      /* Styles identical to your previous Learning Journals */
      :root {
        --primary-color: #20504b;
        --primary-hover-color: #1a403c;
        --secondary-color: #f4f4f4;
        --text-color: #333;
        --grid-item-bg-color: #2c3e50;
        --alt-grid-item-text-color: #0056b3;
        --customized-orange-light-bg: #b46100;
        --customized-orange-dark-bg: #ffa061;
        --error-color: #d9534f;
      }
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font-family: "Lato", sans-serif; line-height: 1.6; color: var(--text-color); background-color: #d9e1e5; padding: 20px; }
      .container { max-width: 8.5in; margin: 0 auto; background: white; padding: 0.75in; box-shadow: 0 0 10px rgba(0,0,0,.1); }
      .page-header { background-color: var(--primary-color); color: #fff; padding: 20px; text-align: center; margin: -0.75in -0.75in 30px -0.75in; }
      .page-header h1 { color: #fff; border-bottom: none; margin-bottom: 5px; }
      h1 { color: var(--alt-grid-item-text-color); font-size: 28px; margin-bottom: 10px; border-bottom: 3px solid var(--primary-color); padding-bottom: 10px; }
      .header-info { color: #fff; font-size: 14px; line-height: 1.8; }
      .header-info strong { color: var(--customized-orange-dark-bg); }
      h2 { color: var(--alt-grid-item-text-color); font-size: 20px; margin-top: 30px; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 2px solid var(--primary-color); }
      h3 { color: var(--grid-item-bg-color); font-size: 16px; margin-top: 20px; margin-bottom: 10px; }
      p { margin-bottom: 12px; text-align: justify; }
      ul, ol { margin-left: 25px; margin-bottom: 15px; }
      li { margin-bottom: 8px; }
      .toc { background-color: var(--secondary-color); border: 2px solid var(--primary-color); border-radius: 5px; padding: 20px 30px; margin: 25px 0 40px 0; }
      .toc h2 { margin-top: 0; border-bottom: none; color: var(--primary-color); }
      .toc ol { margin-left: 20px; counter-reset: item; list-style-type: none; }
      .toc li { counter-increment: item; margin-bottom: 8px; }
      .toc li:before { content: counter(item) ") "; font-weight: bold; color: var(--primary-color); }
      .toc a { color: var(--customized-orange-light-bg); text-decoration: none; font-weight: bold; }
      .toc a:hover { color: var(--primary-hover-color); text-decoration: underline; }
      .code-block { background-color: var(--secondary-color); border-left: 4px solid var(--primary-color); padding: 15px; margin: 15px 0; font-family: "Courier New", monospace; font-size: 13px; overflow-x: auto; border-radius: 3px; }
      .simple-box { background-color: var(--secondary-color); border: 2px solid var(--primary-color); border-radius: 5px; padding: 15px; margin: 20px 0; text-align: center; font-weight: bold; color: var(--primary-color); }
      .challenge-item { margin-bottom: 20px; }
      .challenge-title { font-weight: bold; color: var(--customized-orange-light-bg); margin-bottom: 5px; }
      .solution { color: var(--primary-color); font-weight: bold; }
      .page-footer { background-color: var(--primary-color); color: #fff; padding: 1.5rem 2rem; text-align: center; font-size: 0.875rem; margin: 30px -0.75in -0.75in -0.75in; }
      .page-footer a { color: var(--customized-orange-dark-bg); font-weight: bold; text-decoration: none; }
      .page-footer a:hover { color: #fff; text-decoration: underline; }
      .page-footer .social-links { margin-bottom: 15px; }
      .page-footer .social-links a { margin: 0 10px; }
       .page-footer p { text-align: center; margin-bottom: 8px; } /* Added text-align center */
      hr { border: none; border-top: 2px solid var(--primary-color); margin: 30px 0; }
      .floating-nav { position: fixed; bottom: 25px; right: 25px; display: flex; flex-direction: column; gap: 10px; z-index: 1000; }
      .floating-nav a { background-color: var(--primary-color); color: white; padding: 12px; border-radius: 50%; text-decoration: none; font-weight: bold; box-shadow: 0 4px 8px rgba(0,0,0,.2); transition: all .3s ease; font-size: 20px; text-align: center; width: 50px; height: 50px; line-height: 26px; }
      .floating-nav a:hover { background-color: var(--customized-orange-dark-bg); color: var(--primary-color); transform: translateY(-2px); }
      .section { margin-bottom: 35px; }
      table { width: 100%; border-collapse: collapse; margin: 15px 0; }
      th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
      th { background-color: var(--secondary-color); }
      code { background-color: #f0f0f0; padding: 2px 5px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 14px; }
      .screenshot-list { list-style-type: disc; margin-left: 20px; } /* Adjust list style */
      .final-links { margin-top: 20px; font-size: 1.1em; }
      .final-links strong { color: var(--primary-color); }
      .final-links a { color: var(--customized-orange-light-bg); word-break: break-all; } /* Use light orange for consistency */
      @media print { /* Print styles unchanged */ }
    </style>
</head>
<body>
    <div class="container">
        <div class="page-header">
            <h1>Learning Journal – Exercise 2.8</h1>
            <div class="header-info">
              <strong>Name:</strong> Ivan Cortes<br />
              <strong>Course:</strong> CareerFoundry – Python for Web Developers<br />
              <strong>Exercise:</strong> 2.8 – Deploying a Django Application<br />
              <strong>Date:</strong> October 21-22, 2025
            </div>
        </div>

        <div class="toc">
            <h2>Table of Contents</h2>
            <ol>
              <li><a href="#about">What This Exercise Was About</a></li>
              <li><a href="#done">What I Did (Step-by-Step Summary)</a></li>
              <li><a href="#issues">Challenges Encountered & Solutions</a></li>
              <li><a href="#skills">New Skills Acquired</a></li>
              <li><a href="#remember">What I'll Remember Most</a></li>
              <li><a href="#shots">Screenshots & Files</a></li>
              <li><a href="#next">Achievement 2 Reflection & Next Steps</a></li>
              <li><a href="#ai">AI Assistance Declaration</a></li>
            </ol>
        </div>

        <div id="about" class="section">
            <h2>1) What This Exercise Was About</h2>
            <p>
                Exercise 2.8 represented the culmination of Achievement 2: transitioning the Recipe App from a local development project to a live web application deployed on a production server. This involved configuring the Django project for a production environment, addressing security concerns, managing static files, setting up a persistent database, and deploying to Heroku.
            </p>
            <p>
                The core tasks involved adapting the application to run outside the simplified development environment. This meant replacing the development server with Gunicorn, handling static files with WhiteNoise, securing sensitive configuration like the `SECRET_KEY` using environment variables, and migrating the database from SQLite to PostgreSQL to ensure data persistence on Heroku's platform. The process highlighted the significant differences between developing locally and deploying publicly.
            </p>
        </div>

        <div id="done" class="section">
            <h2>2) What I Did (Step-by-Step Summary)</h2>
            <p>The deployment process involved several key phases:</p>
            <ol>
                <li>
                    **Phase 0: Pre-Flight Checks:** Verified local environment, Git status, Python/Django versions, and basic app functionality (`runserver`). Ensured migrations were applied locally. (Covered extensively in interactive session).
                </li>
                <li>
                    **Phase 1: Added 'About Me' Page & Global Styling:** Created a dedicated About Me page (`templates/about_me.html`), configured its view (`recipe_project/views.py`) and URL (`recipe_project/urls.py`). Ensured consistent styling using `static/css/style.css`. Tested locally (Screenshot: `02_About_Me_Created.png`).
                </li>
                 <li>
                    **Phase 2: Production Configuration:**
                    <ul>
                        <li>Installed necessary packages: `gunicorn`, `whitenoise`, `python-decouple`, `dj-database-url`, `psycopg2-binary` and updated `requirements.txt`.</li>
                        <li>Created `Procfile` for Heroku process types.</li>
                        <li>Created `runtime.txt` specifying Python version.</li>
                        <li>Created `.env` file for local secrets (added to `.gitignore`).</li>
                        <li>Modified `settings.py` extensively: Integrated `python-decouple`, set `DEBUG=False` based on environment, configured `ALLOWED_HOSTS`, added `WhiteNoise` middleware, set up `STATIC_ROOT` and `STATICFILES_STORAGE`, configured database using `dj-database-url`, and added production security settings.</li>
                        <li>Ran `collectstatic` locally.</li>
                        <li>Committed security fixes and deployment files to Git.</li>
                    </ul>
                </li>
                 <li>
                    **Phase 3: Heroku Setup & Initial Deployment:**
                    <ul>
                        <li>Logged into Heroku CLI.</li>
                        <li>Created the Heroku application (`recipe-app-ivan-cortes`).</li>
                        <li>Attempted to add free PostgreSQL, found it deprecated, added paid `essential-0` tier instead.</li>
                        <li>Set Heroku Config Vars for `DEBUG`, `SECRET_KEY`, `ALLOWED_HOSTS`, and `DATABASE_URL`.</li>
                        <li>Pushed code to Heroku (`git push heroku main`).</li>
                    </ul>
                </li>
                 <li>
                    **Phase 4: Database Migration & Superuser:**
                    <ul>
                        <li>Ran migrations on Heroku (`heroku run python manage.py migrate`) to set up PostgreSQL tables (Screenshot: `05_Migrations_Carried_On_Heroku.png`).</li>
                        <li>Created the required superuser (`mentorCF` / `Ment0r@CareerF0undry`) via `heroku run python manage.py createsuperuser`.</li>
                    </ul>
                </li>
                 <li>
                    **Phase 5: Data Loading (Troubleshooting Heavy):**
                    <ul>
                        <li>Attempted to load exported SQLite data (`recipes_data.json`) using `heroku run python manage.py loaddata`. Failed due to `UnicodeDecodeError` (Latin-1 vs UTF-8).</li>
                        <li>Re-exported data attempting different methods, still failed.</li>
                        <li>Implemented a custom Python script (`load_recipes_fixed.py`) to decode Latin-1, parse JSON, and load data via Django ORM.</li>
                        <li>Executed the custom script successfully via `heroku run bash` and direct Python execution, loading 84 objects.</li>
                    </ul>
                </li>
                 <li>
                    **Phase 6: Image Handling Workaround:**
                    <ul>
                        <li>Realized uploaded images (`ImageField`) wouldn't persist on Heroku's ephemeral filesystem. Images were broken on the live site.</li>
                        <li>Changed `Recipe.pic` model field from `ImageField` to `CharField`.</li>
                        <li>Created and applied a new migration (`0004_alter_recipe_pic.py`). Removed `migrations/` from `.gitignore`.</li>
                        <li>Ran a script via `heroku run bash` to update all `Recipe.pic` values in the database to use an external placeholder URL (`via.placeholder.com`).</li>
                        <li>Updated the `recipes_list.html` template to render `{{ object.pic }}` instead of `{{ object.pic.url }}`.</li>
                    </ul>
                 </li>
                 <li>
                    **Phase 7: Final Testing & Cleanup:**
                    <ul>
                        <li>Verified all features (login, logout, recipe list, search, admin) worked on the live Heroku URL (Screenshots: `07_Login_Functional.png`, `08_Login_FUnctional_Image_Placeholder_Erratic.png`, `04_Admin_Panel.png`, `06_LOgout_Ok.png`).</li>
                        <li>Ran tests locally (`python manage.py test recipes`) and captured `test-report.jpg` (Uploaded as `03_Test_Run_Done.png`).</li>
                        <li>Cleaned up temporary troubleshooting files from the repository.</li>
                        <li>Updated `README.md` and this learning journal comprehensively.</li>
                    </ul>
                </li>
            </ol>
        </div>

        <div id="issues" class="section">
            <h2>3) Challenges Encountered & Solutions</h2>
            <p>This exercise presented significant challenges beyond standard Django development, primarily related to the deployment environment and data migration:</p>

            <div class="challenge-item">
              <div class="challenge-title">Heroku Free Tier Changes</div>
              <p>
                The course materials referenced Heroku's free "hobby-dev" PostgreSQL tier, which is no longer available. This required an unexpected decision between switching platforms or opting for a paid Heroku plan.
              </p>
              <span class="solution">Solution:</span> Chosen solution was to proceed with Heroku's paid "essential-0" plan to fulfill the exercise requirements using the suggested platform. Added the add-on via `heroku addons:create heroku-postgresql:essential-0`.
            </div>

             <div class="challenge-item">
              <div class="challenge-title">Data Migration Encoding Error (`UnicodeDecodeError`)</div>
              <p>
                Migrating recipe data from local SQLite (likely Latin-1 encoded on Windows) to Heroku PostgreSQL (UTF-8) failed repeatedly using `manage.py loaddata` due to accented characters. Standard export/import methods did not handle the encoding conversion.
              </p>
              <span class="solution">Solution:</span> Developed and executed a custom Python script on Heroku. This script read the JSON file, explicitly decoded it from `latin-1`, parsed it, and then used the Django ORM (`get_or_create`) to load the data, correctly handling the transition to UTF-8.
            </div>

            <div class="challenge-item">
              <div class="challenge-title">Image Persistence on Ephemeral Filesystem</div>
              <p>
                Recipe images uploaded locally (`ImageField` storing files in `media/`) disappeared after deployment because Heroku's filesystem is temporary and resets on restarts/deploys.
              </p>
              <span class="solution">Solution (Workaround):</span> Changed the `Recipe.pic` model field from `ImageField` to `CharField`. Ran a script on Heroku to update all database entries to use an external placeholder URL (e.g., `via.placeholder.com`). Modified templates to display this URL directly (`{{ object.pic }}`). Acknowledged that a full solution requires cloud storage (S3).
            </div>

             <div class="challenge-item">
              <div class="challenge-title">Configuration & Dependency Issues</div>
              <p>
                Several smaller issues arose: forgetting `psycopg2-binary` in `requirements.txt`; `SECRET_KEY` syntax issues with `heroku config:set`; `requirements.txt` case sensitivity (`R` vs `r`); incorrect `LOGIN_REDIRECT_URL` namespace; missing `request` argument in `AuthenticationForm`.
              </p>
              <span class="solution">Solution:</span> Addressed each through careful debugging: checking Heroku logs (`heroku logs --tail`), reading error messages, verifying configurations (`heroku config`), correcting file names (`git mv`), updating `settings.py` and `views.py`, and redeploying incrementally. Temporarily setting `DEBUG=True` on Heroku was vital for diagnosing view errors.
            </div>
             <div class="challenge-item">
              <div class="challenge-title">Migrations Not Deploying</div>
              <p>
                The migration needed for the `pic` field change (`0004_alter_recipe_pic.py`) wasn't being applied on Heroku because the `recipes/migrations/` directory was incorrectly listed in `.gitignore`.
              </p>
              <span class="solution">Solution:</span> Removed the relevant line from `.gitignore`, committed the migration files, and redeployed. Ensured the `Procfile`'s `release` command ran migrations automatically.
            </div>
        </div>

        <div id="skills" class="section">
            <h2>4) New Skills Acquired</h2>
            <ul>
                <li>Configuring Django for production (`DEBUG=False`, `ALLOWED_HOSTS`, security settings).</li>
                <li>Managing sensitive configuration via environment variables (`python-decouple`, `.env`, Heroku Config Vars).</li>
                <li>Setting up and configuring `WhiteNoise` for efficient static file serving in production.</li>
                <li>Using `Gunicorn` as a production WSGI server.</li>
                <li>Defining application processes and release tasks using a `Procfile`.</li>
                <li>Deploying Django applications to Heroku via Git.</li>
                <li>Provisioning and connecting to a PostgreSQL database on Heroku using `dj-database-url` and `psycopg2-binary`.</li>
                <li>Understanding and working around PaaS limitations like ephemeral filesystems.</li>
                <li>Debugging deployment issues using platform logs (`heroku logs`).</li>
                <li>Troubleshooting and resolving complex data migration issues, including character encoding mismatches.</li>
                <li>Writing custom Python scripts using the Django ORM to perform data manipulation tasks on the production server.</li>
                <li>Managing database schema changes in production through migrations.</li>
            </ul>
        </div>

        <div id="remember" class="section">
            <h2>5) What I'll Remember Most</h2>
            <p>
                The biggest lesson from this exercise is the significant difference between a local development environment and a live production server. Configuration details that are implicit locally (like `DEBUG=True` or Django serving static files) must be explicitly handled for production, especially regarding security and performance.
            </p>
            <p>
                The data migration encoding problem was a particularly memorable challenge. It underscored that real-world data is often imperfect and standard tools might not suffice. Having to write a custom script using the ORM to bypass `loaddata`'s limitations felt like a genuine problem-solving achievement and highlighted the flexibility of using Python and Django's core components directly.
            </p>
            <p>
                Finally, understanding the implications of Heroku's ephemeral filesystem for handling user-uploaded files (like images) was crucial. It forced a practical workaround (placeholder URLs) but clarified why external storage solutions like AWS S3 are standard practice for scalable web applications. This exercise truly felt like bridging the gap towards building professional, deployable software.
            </p>
        </div>

        <div id="shots" class="section">
             <h2>6) Screenshots & Files</h2>
             <p>Key files updated or created during Exercise 2.8:</p>
             <ul class="screenshot-list">
                <li><code>recipe_project/settings.py</code> (Final production-ready version)</li>
                <li><code>.env</code> (Local environment variables - excluded from Git)</li>
                <li><code>Procfile</code> (Defines Heroku processes)</li>
                <li><code>runtime.txt</code> (Specifies Python version for Heroku)</li>
                <li><code>requirements.txt</code> (Includes `gunicorn`, `whitenoise`, `psycopg2-binary`, etc.)</li>
                <li><code>.gitignore</code> (Updated to ignore `.env` but include `migrations/`)</li>
                <li><code>recipes/migrations/0004_alter_recipe_pic.py</code> (Migration for `pic` field change)</li>
                <li><code>recipes/models.py</code> (Updated `pic` field definition)</li>
                <li><code>recipes/templates/recipes/recipes_list.html</code> (Updated image tag)</li>
                <li><code>recipe_project/management/commands/load_recipes_fixed.py</code> (Custom data loader)</li>
                <li><code>recipes_data_utf8.json</code> (UTF-8 encoded data export)</li>
                <li><code>README.md</code> (Comprehensive update)</li>
                <li><code>LEARNING_JOURNAL_2.8_(15).html</code> (This file)</li>
             </ul>
             <p>Key screenshots (uploaded to `PYTHON-ACHIEVEMENT-2/EXERCISE-2.8/screenshots/`):</p>
              <ul class="screenshot-list">
                 <li>Local server running before deployment (`01_Server_Running.jpg`)</li>
                 <li>About Me page functioning (`02_About_Me_Created.png`)</li>
                 <li>Local tests passing (`03_Test_Run_Done.png` - saved as `test-report.jpg`)</li>
                 <li>Heroku Admin Panel accessible (`04_Admin_Panel.png`)</li>
                 <li>Heroku logs showing successful migrations (`05_Migrations_Carried_On_Heroku.png`)</li>
                 <li>Heroku Logout Success page (`06_LOgout_Ok.png`)</li>
                 <li>Heroku Login page functional (`07_Login_Functional.png`)</li>
                 <li>Heroku Recipe List showing data and placeholder images (`08_Login_FUnctional_Image_Placeholder_Erratic.png`)</li>
                 <li>_(Additional screenshots documenting intermediate steps like Heroku setup, config vars, error messages may also be present)_</li>
             </ul>
        </div>

        <div id="next" class="section">
            <h2>7) Achievement 2 Reflection & Next Steps</h2>
            <p>
                Completing Exercise 2.8 and successfully deploying the Recipe App marks the end of Achievement 2. This journey covered the entire lifecycle of a Django web application: initial project setup, database modeling, building views and templates, implementing user authentication, adding forms and data visualization, writing tests, and finally, deploying to a production environment.
            </p>
            <p>
                While challenging, particularly the deployment phase, this achievement provided a comprehensive foundation in Django development and introduced crucial concepts related to production readiness, security, and real-world platform constraints. The skills learned here are directly applicable to building and launching professional web applications.
            </p>
            <p>
                With Achievement 2 complete, the next steps involve submitting the deliverables for review, incorporating feedback, updating my portfolio with this project, and moving on to the subsequent modules in the CareerFoundry curriculum, likely exploring more advanced web development topics or frameworks.
            </p>
        </div>

        <div id="ai" class="section">
             <h2>8) AI Assistance Declaration</h2>
             <p>
                 AI assistance was utilized extensively during Exercise 2.8, primarily as a technical expert and troubleshooting guide to navigate complexities not fully covered by the course materials, especially those related to current Heroku platform specifics and data migration issues. Key areas where AI provided critical support included:
             </p>
             <ul>
                 <li>Identifying the deprecation of Heroku's free PostgreSQL tier and outlining paid alternatives and configuration steps.</li>
                 <li>Diagnosing the root cause of the `UnicodeDecodeError` during data migration (Latin-1 vs. UTF-8 conflict) and co-developing the custom Python script using the ORM for successful data loading.</li>
                 <li>Explaining Heroku's ephemeral filesystem and its implications for image storage, leading to the `CharField` + placeholder URL workaround strategy.</li>
                 <li>Providing up-to-date syntax and configuration details for production tools (`Gunicorn`, `WhiteNoise`, `dj-database-url`, `psycopg2`, security settings in `settings.py`, `Procfile`).</li>
                 <li>Assisting in interpreting Heroku logs and Python error tracebacks during deployment debugging cycles.</li>
                 <li>Resolving smaller configuration errors related to `SECRET_KEY` handling, file naming conventions, URL namespaces, and form arguments.</li>
             </ul>
             <p>
                 All code modifications, commands, testing, and debugging steps were executed manually. AI functioned as an on-demand technical consultant, providing necessary information and potential solutions when standard documentation or course guides proved insufficient for the specific, real-world challenges encountered during production deployment. This collaborative approach was essential for successfully completing the deployment under the given constraints.
             </p>
        </div>

        <hr />
        <div class="simple-box">
            Exercise 2.8 & Achievement 2 Complete! ✅<br/>
            Application successfully deployed to Heroku with persistent data and functional features.<br/>
            Ready for submission!
        </div>

        <div class="final-links">
            <p><strong>Live Application URL:</strong> <a href="https://recipe-app-ivan-cortes-85dd09314e1e9b4c46e03e443bf66d0007afb272.herokuapp.com/" target="_blank">https://recipe-app-ivan-cortes-8d505e6123c3.herokuapp.com/</a></p>
            <p><strong>GitHub Repository:</strong> <a href="https://github.com/ivencomur/recipe-app" target="_blank">https://github.com/ivencomur/recipe-app</a></p>
            <p><strong>Exercise Deliverables:</strong> <a href="https://github.com/ivencomur/PYTHON-ACHIEVEMENT-2/tree/EXERCISE-2.8" target="_blank">PYTHON-ACHIEVEMENT-2/EXERCISE-2.8</a></p>
        </div>

        <div class="page-footer">
             <p>
                <strong>Learning Journal 2.8 (15)</strong> | Exercise 2.8: Deployment & Production Configuration
                <br>
                CareerFoundry Python for Web Developers | Achievement 2 | October 22, 2025
            </p>
            <p>
                <a href="https://github.com/ivencomur/recipe-app" target="_blank">Recipe App Repository</a> ·
                <a href="https://github.com/ivencomur" target="_blank">GitHub Profile</a> ·
                <a href="https://ivan-cortes-portfolio-v1.onrender.com/" target="_blank">Portfolio</a>
            </p>
        </div>
    </div>

    <div class="floating-nav">
        <a href="../index.html" title="Go to Main Index">🏠</a> <a href="javascript:history.back()" title="Go Back">⬅️</a>
    </div>
</body>
</html>